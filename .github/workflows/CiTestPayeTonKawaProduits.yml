name: CI_tests_unitaires_Produits


on:
  workflow_run:
    workflows: ["CI_tests_Build_Produits"]
    types:
      - completed
jobs:
  test:
    runs-on: ubuntu-latest # Utilise la derniÃ¨re version d'Ubuntu pour l'environnement d'exÃ©cution

    steps:
    - name: ğŸš€ Cloner le code du dÃ©pÃ´t
      uses: actions/checkout@v4 # Action pour rÃ©cupÃ©rer votre code depuis GitHub

    - name: âš™ï¸ Configurer l'environnement Node.js
      uses: actions/setup-node@v4 # Action pour installer Node.js
      with:
        node-version: '20' # IMPORTANT : Assurez-vous que cette version de Node.js correspond Ã  celle de votre projet
        cache: 'npm'       # Active le cache pour les dÃ©pendances npm, ce qui accÃ©lÃ¨re les exÃ©cutions futures

    - name: ğŸ“¦ Installer les dÃ©pendances npm
      run: npm ci # 'npm ci' est prÃ©fÃ©rÃ© Ã  'npm install' dans les CI pour des builds reproductibles et plus rapides

    - name: ğŸ§ª Lancer les tests unitaires avec Jest
      run: npm test # Cette commande exÃ©cute le script 'test' dÃ©fini dans votre package.json (qui devrait Ãªtre 'jest')
      env:
        # Les variables d'environnement nÃ©cessaires pour vos tests (mÃªme si Prisma est mockÃ© ou si elles sont lues par votre code)
        # sont injectÃ©es ici Ã  partir des secrets GitHub (si ce sont des secrets) ou dÃ©finies directement.
        # Les noms des variables (DATABASE_URL, JWT_SECRET, JWT_EXPIRE) doivent correspondre EXACTEMENT
        # aux noms que vous avez dÃ©finis dans les secrets de votre dÃ©pÃ´t GitHub.
        DATABASE_URL: ${{ secrets.DATABASE_URL }}
        JWT_SECRET: ${{ secrets.JWT_SECRET }}
        JWT_EXPIRE: ${{ secrets.JWT_EXPIRE }}
        PORT: 3000 # Le port peut aussi Ãªtre nÃ©cessaire si vos tests dÃ©marrent un petit serveur ou simulent des appels HTTP
